<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="伪全栈"><meta name="baidu-site-verification" content="yKAzGITNoG"><title>最近很火的倒放挑战(含前后端源码) | Smackgg</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">最近很火的倒放挑战(含前后端源码)</h1><a id="logo" href="/.">Smackgg</a><p class="description">你好，兄dei</p></div><div id="nav-menu"> <a class="current" href="/."><i class="fa fa-home">首页</i></a> <a href="/archives/"><i class="fa fa-archive">归档</i></a> <a href="/about/"><i class="fa fa-user">关于</i></a> <a href="/atom.xml"><i class="fa fa-rss">订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">最近很火的倒放挑战(含前后端源码)</h1><div class="post-meta">Dec 9, 2019 <span>|</span><span class="leancloud_visitors" id="/2019/12/09/最近很火的倒放挑战(含前后端源码)/" data-flag-title="最近很火的倒放挑战(含前后端源码)"><span id="leancloud-visitors-count"></span> <span>阅读</span></span></div><a class="ds-thread-count" href="/2019/12/09/最近很火的倒放挑战(含前后端源码)/#SOHUCS"><span id="changyan_count_unit" style="font-size:15px;color:#6E7173">0</span> <span>条评论</span></a><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js" async></script><div class="post-content"><p>最近很火的 倒放挑战 - ReverseVoice (微信小程序版 前后端源码) Ts Node Taro<br><a id="more"></a></p><p>项目地址: <a href="https://github.com/smackgg/reversevoice" target="_blank" rel="noopener">https://github.com/smackgg/reversevoice</a></p><p>整个项目其实很简单，从本人在抖音和 B 站看到火起来到最终小程序上线也就几天的下班时间就搞定了，11月16日上线至今用户量还是蛮多的(主要当时做的快此类 app 比较少😂)，现在已经出现了大量的更简约更好的倒放挑战 app，本项目开源仅供大家学习~</p><p>拥抱 TypeScript ~</p><p>顺便小声吐槽一下 Taro 对 Ts 的支持还是不够啊，希望大家多去给 Taro 提 dts 的 PR ~</p><h1 id="体验"><a href="#体验" class="headerlink" title="体验"></a>体验</h1><h2 id="小程序二维码"><a href="#小程序二维码" class="headerlink" title="小程序二维码"></a>小程序二维码</h2><p><img width="250" src="https://user-gold-cdn.xitu.io/2019/11/27/16eaca05d0abe700?w=200&h=200&f=jpeg&s=100731"></p><h2 id="挑战分享海报-这个海报暂时有问题，修复代码因为资质问题还没有提交审核"><a href="#挑战分享海报-这个海报暂时有问题，修复代码因为资质问题还没有提交审核" class="headerlink" title="挑战分享海报 (这个海报暂时有问题，修复代码因为资质问题还没有提交审核)"></a>挑战分享海报 (这个海报暂时有问题，修复代码因为资质问题还没有提交审核)</h2><p><img width="250" src="https://user-gold-cdn.xitu.io/2019/11/27/16eaca00043c3c75?w=900&h=1599&f=png&s=16770"></p><h1 id="功能介绍-实现原理"><a href="#功能介绍-实现原理" class="headerlink" title="功能介绍/实现原理"></a>功能介绍/实现原理</h1><ul><li>功能及实现原理简述</li></ul><ol><li>小程序端用户录音并保存本地</li><li>录音后将录音文件上传至后端进行倒放处理，并返回处理后的音频 url</li><li>小程序端下载 url 文件，提示用户反转成功，将数据做本地 map</li><li>用户点击分享，生成分享链接，并将该分享正放、倒放视频均传至后端保存至七牛云</li><li>同时新建分享 room 保存用户信息，返回 roomId</li><li>用户分享（海报分享 canvas 动态生成分享码海报）</li><li>其它用户参加挑战，存储原理同 4，只是增加将挑战者信息了存入 room 的逻辑</li></ol><ul><li><p>音频倒放<br>使用 ffmpeg 进行音频倒放，核心代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 详见 ./server/src/controllers/file.ts =&gt; function reverseVoice</span></span><br><span class="line"><span class="keyword">import</span> ffmpegPath <span class="keyword">from</span> <span class="string">'@ffmpeg-installer/ffmpeg'</span></span><br><span class="line"><span class="keyword">import</span> ffprobePath <span class="keyword">from</span> <span class="string">'@ffprobe-installer/ffprobe'</span></span><br><span class="line"><span class="keyword">import</span> ffmpeg <span class="keyword">from</span> <span class="string">'fluent-ffmpeg'</span></span><br><span class="line">ffmpeg.setFfprobePath(ffprobePath.path)</span><br><span class="line">ffmpeg.setFfmpegPath(ffmpegPath.path)</span><br><span class="line"></span><br><span class="line">ffmpeg(filepath)</span><br><span class="line">    .format(<span class="string">'mp4'</span>)</span><br><span class="line">    <span class="comment">// 反转</span></span><br><span class="line">    .outputOptions([</span><br><span class="line">      <span class="string">'-vf reverse'</span>,</span><br><span class="line">      <span class="string">'-af areverse'</span>,</span><br><span class="line">      <span class="string">'-preset'</span>,</span><br><span class="line">      <span class="string">'superfast'</span>,</span><br><span class="line">      <span class="string">'-y'</span>,</span><br><span class="line">    ])</span><br><span class="line">    .on(<span class="string">'progress'</span>, (progress) =&gt; &#123;</span><br><span class="line">      <span class="comment">// send upload progress</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'upload-file-progress'</span>, progress.percent)</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">'error'</span>, (err) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Ffmpeg has been killed<span class="subst">$&#123;err.message&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .toFormat(<span class="string">'mp3'</span>)</span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    .save(publicPath + saveFilePath)</span><br><span class="line">    .on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="comment">// 获取音频信息（时长等）</span></span><br><span class="line">      ffmpeg.ffprobe(publicPath + saveFilePath, (err, metadata) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(metadata.format.duration)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></li><li><p>小程序录音<br>小程序录音使用官方 api，详细逻辑见 <a href="https://github.com/smackgg/reversevoice/blob/master/wechatapp/src/pages/index/index.tsx#L136" target="_blank" rel="noopener">./wechatapp/pages/index/index.tsx</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/api/media/audio/InnerAudioContext.html" target="_blank" rel="noopener">录音相关文档</a></p></li><li><p>海报生成<br>利用 canvas 动态合成分享海报 <a href="https://github.com/smackgg/reversevoice/blob/master/wechatapp/pages/sharePoster" target="_blank" rel="noopener">/wechatapp/pages/sharePoster</a><br>需要动态请求页面小程序码，涉及微信AccessToken鉴权等，详见 <a href="https://github.com/smackgg/reversevoice/blob/master/server/src/controllers/wechat.ts" target="_blank" rel="noopener">/server/src/controllers/wechat.ts</a>, 下面贴出部分核心代码</p></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 画图</span></span><br><span class="line"><span class="keyword">const</span> draw = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 绘制之前 loading</span></span><br><span class="line">  Taro.showLoading(&#123;</span><br><span class="line">    title: <span class="string">'海报生成中...'</span>,</span><br><span class="line">    mask: <span class="literal">true</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// 获取图片信息</span></span><br><span class="line">  <span class="keyword">const</span> [productImgInfo, qrcodeImgInfo] = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">    <span class="keyword">this</span>.getImageInfo(sharePoster), <span class="comment">// 获取主图</span></span><br><span class="line">    <span class="keyword">this</span>.getQrImgInfo(), <span class="comment">// 获取二维码图片</span></span><br><span class="line">  ])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// product image 宽高</span></span><br><span class="line">  <span class="keyword">const</span> pW = CANVAS_WIDTH</span><br><span class="line">  <span class="keyword">const</span> pH = (pW / productImgInfo.width) * productImgInfo.height</span><br><span class="line"></span><br><span class="line">  <span class="comment">// canvas 高度</span></span><br><span class="line">  <span class="keyword">let</span> canvasHeight = pH</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ctx = Taro.createCanvasContext(<span class="string">'canvas'</span>, <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  ctx.fillStyle = <span class="string">'#fff'</span></span><br><span class="line">  ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, CANVAS_WIDTH, canvasHeight)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 绘制背景图片</span></span><br><span class="line">  ctx.drawImage(sharePoster, <span class="number">0</span>, <span class="number">0</span>, pW, pH)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 绘制二维码 （因为有角度，需要旋转画布，再旋转回来）</span></span><br><span class="line">  ctx.rotate(-<span class="built_in">Math</span>.PI / <span class="number">32</span>)</span><br><span class="line">  ctx.translate(<span class="number">-25</span> * ratio, <span class="number">10</span> * ratio)</span><br><span class="line">  ctx.drawImage(qrcodeImgInfo.path, QR_LEFT, QR_TOP, QR_WIDTH, QR_WIDTH)</span><br><span class="line">  ctx.rotate(<span class="built_in">Math</span>.PI / <span class="number">32</span>)</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    canvasStyle: &#123;</span><br><span class="line">      ...this.state.canvasStyle,</span><br><span class="line">      height: canvasHeight,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  ctx.stroke()</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    Taro.hideLoading()</span><br><span class="line">    ctx.draw()</span><br><span class="line">  &#125;, <span class="number">500</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>微信分享 HOC 函数 <a href="https://github.com/smackgg/reversevoice/blob/master/wechatapp/src/components/%40withShare/index.tsx" target="_blank" rel="noopener">./wechatapp/components/@withShare</a></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 微信小程序每个页面几乎都需要配置分享的参数，并且需要动态更改分享参数</span></span><br><span class="line"><span class="comment">// 所以抽离 HOC 组件，方便页面使用</span></span><br><span class="line"><span class="keyword">import</span> &#123; ComponentClass &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Taro <span class="keyword">from</span> <span class="string">'@tarojs/taro'</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'@tarojs/redux'</span>;</span><br><span class="line"><span class="keyword">import</span> defaultShareImg <span class="keyword">from</span> <span class="string">'@/assets/images/share.png'</span></span><br><span class="line"></span><br><span class="line">type Options = &#123;</span><br><span class="line">  title?: string</span><br><span class="line">  imageUrl?: string</span><br><span class="line">  path?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defalutOptions: Options = &#123;</span><br><span class="line">  title: <span class="string">'你能听懂我说啥么？最近很火的反转录音来啦~'</span>,</span><br><span class="line">  imageUrl: defaultShareImg,</span><br><span class="line">  path: <span class="string">'pages/index/index'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">withShare</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">demoComponent</span>(<span class="params">Component: ComponentClass</span>) </span>&#123;</span><br><span class="line">    @connect(<span class="function">(<span class="params">&#123; user &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">      userInfo: user.userInfo</span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WithShare</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">      $shareOptions?: Options</span><br><span class="line">      <span class="keyword">async</span> componentWillMount() &#123;</span><br><span class="line">        Taro.showShareMenu(&#123;</span><br><span class="line">          withShareTicket: <span class="literal">true</span>,</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">super</span>.componentWillMount) &#123;</span><br><span class="line">          <span class="keyword">super</span>.componentWillMount()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 点击分享的那一刻会进行调用</span></span><br><span class="line">      onShareAppMessage() &#123;</span><br><span class="line">        <span class="comment">// const sharePath = `$&#123;path&#125;&amp;shareFromUser=$&#123;userInfo.shareId&#125;`</span></span><br><span class="line">        <span class="keyword">let</span> options = defalutOptions</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.$shareOptions) &#123;</span><br><span class="line">          options = &#123;</span><br><span class="line">            ...defalutOptions,</span><br><span class="line">            ...this.$shareOptions,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> options</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.render()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> WithShare</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withShare</span><br></pre></td></tr></table></figure><p><a href="https://github.com/smackgg/reversevoice/blob/master/wechatapp/src/pages/index/index.tsx#L53" target="_blank" rel="noopener">使用</a><br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@withShare()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指定config的类型声明为: Taro.Config</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 由于 typescript 对于 object 类型推导只能推出 Key 的基本类型</span></span><br><span class="line"><span class="comment"> * 对于像 navigationBarTextStyle: 'black' 这样的推导出的类型是 string</span></span><br><span class="line"><span class="comment"> * 提示和声明 navigationBarTextStyle: 'black' | 'white' 类型冲突, 需要显示声明类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  config: Config = &#123;</span><br><span class="line">    navigationBarTitleText: <span class="string">'首页'</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $shareOptions = &#123;</span><br><span class="line">    title: <span class="string">'倒放挑战！你能听懂我倒立洗头~'</span>,</span><br><span class="line">    path: <span class="string">'pages/index/index'</span>,</span><br><span class="line">    imageUrl: <span class="string">''</span>,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    ....</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><ul><li>微信用户登录流程<br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html" target="_blank" rel="noopener">微信官方文档登录流程</a><br>具体实现可以去看源码</li></ul><h1 id="项目运行-后端"><a href="#项目运行-后端" class="headerlink" title="项目运行 - 后端"></a>项目运行 - 后端</h1><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>需要提前安装:</p><ul><li>Install <a href="https://nodejs.org/en/" target="_blank" rel="noopener">Node.js</a></li><li>Install <a href="https://docs.mongodb.com/manual/installation/" target="_blank" rel="noopener">MongoDB</a></li></ul><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><ul><li><p>克隆项目并进入后端目录</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="keyword">server</span></span><br></pre></td></tr></table></figure></li><li><p>安装依赖</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span></span><br></pre></td></tr></table></figure></li><li><p>设置 mongoDB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create the db directory</span></span><br><span class="line">sudo mkdir -p /data/db</span><br><span class="line"><span class="comment"># give the db correct read/write permissions</span></span><br><span class="line">sudo chmod 777 /data/db</span><br><span class="line"></span><br><span class="line"><span class="comment"># starting from macOS 10.15 even the admin cannot create directory at root</span></span><br><span class="line"><span class="comment"># so lets create the db diretory under the home directory.</span></span><br><span class="line">mkdir -p ~/data/db</span><br><span class="line"><span class="comment"># user account has automatically read and write permissions for ~/data/db.</span></span><br></pre></td></tr></table></figure></li><li><p>启动 mongoDB (Start your mongoDB server (you’ll probably want another command prompt)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mongod</span><br><span class="line"></span><br><span class="line"><span class="comment"># on macOS 10.15 or above the db directory is under home directory</span></span><br><span class="line">mongod --dbpath ~/data/db</span><br></pre></td></tr></table></figure></li><li><p>打包并运行项目</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> run build</span><br><span class="line"><span class="built_in">npm</span> start</span><br></pre></td></tr></table></figure></li></ul><h1 id="项目运行-小程序端"><a href="#项目运行-小程序端" class="headerlink" title="项目运行 - 小程序端"></a>项目运行 - 小程序端</h1><h2 id="准备-1"><a href="#准备-1" class="headerlink" title="准备"></a>准备</h2><p>需要提前安装:</p><ul><li>Install <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener">微信开发者工具</a></li></ul><h2 id="开始-1"><a href="#开始-1" class="headerlink" title="开始"></a>开始</h2><ul><li><p>克隆项目并进入小程序目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> wechatapp</span><br></pre></td></tr></table></figure></li><li><p>安装依赖</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span></span><br></pre></td></tr></table></figure></li><li><p>新建 .env 文件</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在 wechatapp/src/utils 目录下克隆 env<span class="selector-class">.example</span><span class="selector-class">.ts</span> 文件至同目录命名为 <span class="selector-class">.env</span><span class="selector-class">.ts</span> 文件</span><br><span class="line">此文件两个参数分别代表本地开发和线上部署的请求地址</span><br></pre></td></tr></table></figure></li><li><p>运行项目</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="built_in">run</span> dev:weapp <span class="comment">// development mode</span></span><br><span class="line">或者 npm <span class="built_in">run</span> build:weapp <span class="comment">// production mode</span></span><br></pre></td></tr></table></figure></li><li><p>微信开发者工具</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">选择导入项目，并选择 wechatapp/<span class="built_in">dist</span> 目录</span><br><span class="line">若本地开发，需要在开发者工具中设置开启“不校验合法域名“</span><br></pre></td></tr></table></figure></li></ul><h1 id="License"><a href="#License" class="headerlink" title="License"></a>License</h1><p>MIT</p></div><iframe src="/donate/?AliPayQR=/img/AliPayQR.jpg&amp;WeChatQR=/img/WeChatQR.jpg&amp;GitHub=https://github.com/smackgg&amp;BTCQR=null&amp;BTCKEY=null&amp;PayPal=null" style="overflow-x:hidden;overflow-y:hidden;border:0xp none #fff;min-height:240px;width:100%" frameborder="0" scrolling="no"></iframe><div class="tags"><a href="/tags/微信小程序/">微信小程序</a></div><div class="post-nav"><a class="next" href="/2017/03/08/electron-daying/">使用 Electron 快速开发桌面应用(附实例，源码)。</a></div><div id="SOHUCS" sid="1575889012000"></div><script>!function(){var t="cytwmWeN3",e="54ae93d9b5daa95aace5bfdf4e84dca1",n=window.innerWidth||document.documentElement.clientWidth;if(n<960)window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+t+"&conf="+e+'"><\/script>');else{var a=function(t,e){var n=document.getElementsByTagName("head")[0]||document.head||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("charset","UTF-8"),a.setAttribute("src",t),"function"==typeof e&&(window.attachEvent?a.onreadystatechange=function(){var t=a.readyState;"loaded"!==t&&"complete"!==t||(a.onreadystatechange=null,e())}:a.onload=e),n.appendChild(a)};a("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:t,conf:e})})}}()</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://blog.smackgg.cn"></form></div><div class="widget"><div class="widget-title"> <i class="fa fa-folder-o">分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Electron/">Electron</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/与-CSS-相关的兼容性问题/">与 CSS 相关的兼容性问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/与渲染HTML相关的兼容性问题/">与渲染HTML相关的兼容性问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/与渲染混合类型相关的兼容性问题/">与渲染混合类型相关的兼容性问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/与脚本相关的兼容性问题/">与脚本相关的兼容性问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/作用域链和标识符详细解析/">作用域链和标识符详细解析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/关于主题/">关于主题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/浅谈BFC实际应用/">浅谈BFC实际应用</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-1/">高性能JavaScript-1</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-10/">高性能JavaScript-10</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-2/">高性能JavaScript-2</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-3/">高性能JavaScript-3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-4/">高性能JavaScript-4</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-5/">高性能JavaScript-5</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-6/">高性能JavaScript-6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-7/">高性能JavaScript-7</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-8/">高性能JavaScript-8</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/高性能JavaScript-9/">高性能JavaScript-9</a></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-star-o">标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size:15px">hexo</a> <a href="/tags/Electron/" style="font-size:15px">Electron</a> <a href="/tags/兼容性/" style="font-size:15px">兼容性</a> <a href="/tags/高性能JavaScript学习笔记/" style="font-size:15px">高性能JavaScript学习笔记</a> <a href="/tags/没事瞎扯/" style="font-size:15px">没事瞎扯</a> <a href="/tags/CSS/" style="font-size:15px">CSS</a> <a href="/tags/微信小程序/" style="font-size:15px">微信小程序</a></div></div><div class="widget"><div class="widget-title"> <i class="fa fa-file-o">最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/09/最近很火的倒放挑战(含前后端源码)/">最近很火的倒放挑战(含前后端源码)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/08/electron-daying/">使用 Electron 快速开发桌面应用(附实例，源码)。</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/31/hexo主题添加阅读数/">为hexo-theme-smackdown主题添加阅读数</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/12/写代码强行装逼/">写代码强行装逼</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/21/与 CSS 相关的兼容性问题/">与 CSS 相关的兼容性问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/19/与脚本相关的兼容性问题/">与脚本相关的兼容性问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/15/与服务端通信相关的兼容性问题/">与脚本相关的兼容性问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/14/与渲染混合类型相关的兼容性问题/">与渲染混合类型相关的兼容性问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/12/与渲染HTML相关的兼容性问题/">与渲染HTML相关的兼容性问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/08/浅谈BFC实际应用/">浅谈BFC的实际应用</a></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-external-link">友情链接</i></div><ul></ul><a href="https://github.com/smackgg/hexo-theme-smackdown" title="hexo-theme-smackdown" target="_blank">hexo-theme-smackdown</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"><p>Copyright © 2019 京ICP备17049908号-1</p><a href="/." rel="nofollow">Smackgg.</a> Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo.</a> <a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo">Theme</a> by <a rel="nofollow" target="_blank" href="https://github.com/pagecho">Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("K1qAIJa0JgKeGUnrlq0G526F-gzGzoHsz","n4XwRe0iBOxWpBaYJ7HNWPA3")</script><script type="text/javascript" src="/js/Counter.js?v=0.0.0" async></script></div></body></html>